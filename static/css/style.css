/* Plan Calendar style v25 (Glass Text + Compact Flex Layout)
   - Month Title: Pure Glass Text (No badge background)
   - Day Cell: Starts extremely compact (approx 1 icon height)
   - Icon Layout: 
     1 -> 2 (Stack Vertically)
     3 -> 4 (Wrap to Next Column)
     Implemented via Flexbox Column Wrap + Fixed Max-Height constraint
*/

:root{
  --bg: #f6f7fb;
  --text: #111111;

  --surface: #ffffff;
  --surface2: #f3f4f6;

  --border: rgba(17,17,17,0.08);
  --muted: rgba(17,17,17,0.55);

  --sun: #e11d48;
  --sat: #2563eb;
  --holiday: #dc2626;

  --radius-card: 22px;
  --radius-shell: 26px;

  --header-h: 66px;
  --weekday-h: 34px;

  /* Icon Size Tunables */
  --icon-size: 18px;
  --icon-gap: 2px;
  /* Max-height for icons container to force wrapping after 2 items:
     (IconSize * 2) + Gap = 18*2 + 2 = 38px
  */
  --icon-area-h: 38px; 
}

*{ box-sizing: border-box; }
html, body { height: 100%; }

body{
  margin:0;
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text",
               system-ui, "Apple SD Gothic Neo", "Noto Sans KR", "Segoe UI", Roboto, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;

  background:
    radial-gradient(1200px 800px at 50% -200px, rgba(0,0,0,0.045), transparent 55%),
    radial-gradient(900px 700px at 0% 110%, rgba(0,0,0,0.035), transparent 55%),
    var(--bg);

  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}

.hidden{ display:none !important; }
.container{ width:100%; max-width:100%; margin:0; padding:0; }

button{
  border: none;
  background: transparent;
  color: inherit;
  cursor: pointer;
  font-family: inherit;
  -webkit-tap-highlight-color: transparent;
}

.hint{ font-size: 12px; color: color-mix(in srgb, var(--text) 45%, transparent); margin-top: 8px; }

/* ---------- Auth card ---------- */
.card{
  background: color-mix(in srgb, var(--surface) 92%, transparent);
  border: 1px solid color-mix(in srgb, var(--border) 85%, transparent);
  border-radius: var(--radius-card);
  box-shadow: 0 16px 44px rgba(0,0,0,0.10);
  padding: 16px;
  backdrop-filter: blur(10px);
}

#loginCard.card{ margin: 14px 12px 18px; }

.login-title{
  font-size: 22px;
  font-weight: 800;
  letter-spacing: -0.02em;
  margin-bottom: 10px;
}

.field{ display:block; margin: 12px 0; }
.field > span{
  display:block;
  font-size: 12px;
  color: color-mix(in srgb, var(--text) 42%, transparent);
  margin-bottom: 6px;
}

.field input, .field select{
  width:100%;
  padding: 12px 12px;
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
  border-radius: 16px;
  font-size: 15px;
  outline: none;
  background: color-mix(in srgb, var(--surface) 96%, transparent);
  color: var(--text);
}

.field input:focus, .field select:focus{
  border-color: color-mix(in srgb, var(--text) 18%, transparent);
  box-shadow: 0 0 0 4px rgba(0,0,0,0.045);
}

.login-actions{
  display:flex;
  gap: 10px;
  margin-top: 6px;
}
@media (max-width: 420px){ .login-actions{ flex-direction: column; } }

.primary{
  background: color-mix(in srgb, var(--text) 94%, transparent);
  color: var(--surface);
  padding: 12px 14px;
  border-radius: 16px;
  font-weight: 800;
  box-shadow: 0 10px 20px rgba(0,0,0,0.12);
}
.primary:active{ transform: scale(0.985); }

.ghostbtn{
  background: rgba(0,0,0,0.055);
  padding: 12px 14px;
  border-radius: 16px;
  font-weight: 700;
}
.ghostbtn:hover{ background: rgba(0,0,0,0.085); }
.ghostbtn:active{ transform: scale(0.985); }

.fullbtn{ width:100%; }

.dangerbtn{
  width: 100%;
  background: rgba(225,29,72,0.10);
  color: #e11d48;
  padding: 12px 14px;
  border-radius: 16px;
  font-weight: 800;
}

/* ---------- Calendar shell ---------- */
#appShell .calendar-shell{
  height: calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  padding: 12px 12px 14px;
  display:flex;
  flex-direction: column;
  overflow: hidden;

  background: color-mix(in srgb, var(--surface) 92%, transparent);
  border: 1px solid color-mix(in srgb, var(--border) 75%, transparent);
  border-radius: var(--radius-shell);
  box-shadow: 0 22px 70px rgba(0,0,0,0.12);
  backdrop-filter: blur(12px);

  margin: 10px 10px 14px;
}

@media (min-width: 768px){
  .container{ max-width: 920px; margin: 0 auto; padding: 18px 18px 26px; }
  #appShell .calendar-shell{ margin: 0; }
}

/* ---------- Header ---------- */
.cal-header{
  height: var(--header-h);
  display:grid;
  grid-template-columns: 1fr auto 1fr;
  align-items:center;
  gap: 8px;
  padding: 6px 4px 10px;
}

.cal-year{ display:flex; align-items:flex-start; min-width: 60px; }
.year-label{
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 0.02em;
  color: color-mix(in srgb, var(--text) 35%, transparent);
}

.cal-nav{
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
}

/* ========================================================= */
/* GLASS TEXT EFFECT (Month Title) */
/* "글씨 그 자체가 유리질감이 나게" */
/* ========================================================= */
.month-title{
  font-size: clamp(32px, 8.6vw, 44px);
  font-weight: 900;
  letter-spacing: -0.04em;
  line-height: 1;
  padding: 0 10px;
  min-width: 150px;
  text-align:center;

  /* Transparent text fill */
  color: rgba(255, 255, 255, 0.1); 
  
  /* Specular Highlight & Depth Shadow */
  /* Top-left light, Bottom-right shadow */
  text-shadow: 
    1px 1px 0 rgba(255, 255, 255, 0.25), 
    -1px -1px 0 rgba(0, 0, 0, 0.1),
    0 20px 30px rgba(0,0,0,0.1);
    
  /* Blend mode to interact with background */
  mix-blend-mode: hard-light;
}

/* If user theme is very light, we need inverted shadows to see the glass */
@media (prefers-color-scheme: light) {
  .month-title {
     /* Darker glass for light mode */
     color: rgba(0, 0, 0, 0.05);
     text-shadow: 
       -1px -1px 0 rgba(0,0,0,0.1),
       1px 1px 0 rgba(255,255,255,0.6);
  }
}

.navchev{
  width: 36px;
  height: 36px;
  border-radius: 999px;
  font-size: 30px;
  display:flex;
  align-items:center;
  justify-content:center;
  color: color-mix(in srgb, var(--text) 65%, transparent);
  background: rgba(0,0,0,0.04);
  transition: background 120ms ease, color 120ms ease, transform 120ms ease;
}
.navchev:hover{ background: rgba(0,0,0,0.075); color: var(--text); }
.navchev:active{ transform: scale(0.96); }

.cal-actions{ display:flex; align-items:center; justify-content:flex-end; }

.settingsbtn{
  width: 36px;
  height: 36px;
  border-radius: 999px;
  background: rgba(0,0,0,0.04);
  border: 1px solid rgba(0,0,0,0.03);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: 17px;
  color: color-mix(in srgb, var(--text) 70%, transparent);
  transition: background 120ms ease, transform 120ms ease;
}
.settingsbtn:hover{ background: rgba(0,0,0,0.075); }
.settingsbtn:active{ transform: scale(0.96); }

/* ---------- Weekdays ---------- */
.weekdays{
  height: var(--weekday-h);
  display:grid;
  grid-template-columns: repeat(7, 1fr);
  padding: 2px 6px 8px;
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: color-mix(in srgb, var(--text) 40%, transparent);
}
.weekdays > div{ text-align:center; }
.weekdays .sun{ color: color-mix(in srgb, var(--sun) 88%, transparent); }
.weekdays .sat{ color: color-mix(in srgb, var(--sat) 88%, transparent); }

/* ---------- Grid (Glass Tray) ---------- */
.grid{
  flex: 1;
  display:grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px; 
  padding: 8px;
  
  /* Start rows extremely compact. Grow if needed. */
  grid-auto-rows: minmax(min-content, auto); 

  background: color-mix(in srgb, var(--surface) 10%, transparent);
  border-radius: 20px;
  border: 1px solid color-mix(in srgb, var(--text) 5%, transparent);
  box-shadow: inset 0 0 20px rgba(0,0,0,0.02);
  
  overflow: hidden;
  min-width: 0;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* ---------- Day cell (Compact Glass Plates) ---------- */
.day{
  background: color-mix(in srgb, var(--surface) 72%, transparent);
  border: 1px solid color-mix(in srgb, var(--text) 8%, transparent);
  border-radius: 14px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.03), inset 0 1px 0 rgba(255,255,255,0.15);

  /* PADDING REDUCED: Compact fit */
  padding: 4px;
  
  display:flex;
  flex-direction: column;
  justify-content: flex-start;
  gap: 2px; /* Gap between Date number and Icons */

  min-width: 0;
  min-height: 0; /* Let it shrink to content */
  overflow: hidden;
  touch-action: manipulation;
  transition: box-shadow 140ms ease, transform 120ms ease, background 140ms ease;
}

.day:active{ transform: scale(0.98); }

.day.empty{
  background: transparent;
  border-color: transparent;
  box-shadow: none;
  pointer-events: none;
}

/* Day Number */
.day-num{
  display:flex;
  justify-content:flex-end;
  align-items:center;
  font-size: 12px;
  font-weight: 800;
  line-height: 1;
  
  /* Minimal padding to sit tight at top right */
  padding: 2px 2px 0 0;
  
  color: color-mix(in srgb, var(--text) 76%, transparent);
  opacity: 0.7;
}

.day.sun .day-num{ color: var(--sun); opacity: 1; }
.day.sat .day-num{ color: var(--sat); opacity: 1; }
.day.holiday .day-num{ color: var(--holiday); opacity: 1; }

.day.today{
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--text) 30%, transparent),
    0 4px 12px rgba(0,0,0,0.08);
  background: color-mix(in srgb, var(--surface) 85%, transparent);
}

.day.selected{
  z-index: 2;
  box-shadow: 
    inset 0 0 0 2px color-mix(in srgb, var(--text) 50%, transparent),
    0 8px 20px rgba(0,0,0,0.15);
  background: color-mix(in srgb, var(--surface) 98%, transparent);
  transform: translateY(-1px);
}

/* ========================================================= */
/* ICON LAYOUT LOGIC (Flex Column Wrap) */
/* Requirements:
   - 1 icon: Fits compact
   - 2 icons: Stacks vertically (1 / 2)
   - 3 icons: Wraps to right (1 3 / 2 4)
*/
/* ========================================================= */
.day-dots{
  display: flex;
  flex-direction: column;
  flex-wrap: wrap; /* Wrap to next column if height exceeded */
  
  /* CRITICAL: Constrain height to exactly 2 rows + gap */
  max-height: var(--icon-area-h); 
  
  gap: var(--icon-gap);
  align-content: center; /* Center columns if multiple */
  justify-content: flex-start;

  margin-top: 0;
  width: 100%;
  
  /* Allow overflow if more than 4, but 4 is the visual sweet spot */
  overflow: hidden; 
}

/* Remove grid classes from JS logic, use universal flex item styling */
.day-dots.single, .day-dots.double {
  /* No specific override needed for layout, flex handles it */
}

/* Icon Sizing */
.icon-emoji{
  font-size: var(--icon-size);
  line-height: 1;
  width: var(--icon-size);
  height: var(--icon-size);
  text-align: center;
  filter: saturate(1.05);
}

.icon-img{
  width: var(--icon-size);
  height: var(--icon-size);
  border-radius: 6px;
  object-fit: cover;
  display:block;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* Special Case: If there is ONLY 1 icon (class .single added by JS), make it bigger? 
   User asked for "compact", so maybe keep it small or slightly bigger.
   Let's keep it small to satisfy "More, more, more compact". 
   If you want the single icon BIG, uncomment below.
*/
/*
.day-dots.single .icon-emoji { font-size: 24px; width: 24px; height: 24px; }
.day-dots.single .icon-img { width: 24px; height: 24px; }
*/


/* ---------- Modals ---------- */
.modal.hidden{ display:none; }
.modal{ position: fixed; inset:0; z-index: 50; }
.modal-backdrop{ position:absolute; inset:0; background: rgba(0,0,0,0.46); }

.modal-panel{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%, -50%);
  width: min(680px, calc(100% - 22px));
  background: color-mix(in srgb, var(--surface) 95%, transparent);
  border-radius: var(--radius-card);
  overflow:hidden;
  box-shadow: 0 40px 120px rgba(0,0,0,0.38);
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
  backdrop-filter: blur(14px);
}

.modal-header, .modal-footer{
  padding: 12px 14px;
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
}

.modal-header{ border-bottom: 1px solid color-mix(in srgb, var(--border) 75%, transparent); }
.modal-footer{ border-top: 1px solid color-mix(in srgb, var(--border) 75%, transparent); }

.modal-title{
  font-size: 18px;
  font-weight: 800;
  letter-spacing: -0.02em;
}

.xbtn{
  width: 36px;
  height: 36px;
  border-radius: 999px;
  background: rgba(0,0,0,0.05);
  font-size: 20px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.xbtn:hover{ background: rgba(0,0,0,0.09); }

.modal-body{ padding: 12px 14px; max-height: 70vh; overflow:auto; }

/* ---------- Lists ---------- */
.habit-list{ display:flex; flex-direction: column; gap: 10px; }

.habit-row{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  padding: 12px 12px;
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
  border-radius: 18px;
  background: color-mix(in srgb, var(--surface2) 92%, transparent);
}

.habit-left{ display:flex; align-items:center; gap: 10px; min-width:0; }
.habit-title{
  font-weight: 800;
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.habit-icon{
  width: 22px; height: 22px;
  display:flex; align-items:center; justify-content:center;
}
.habit-icon img{ width: 22px; height: 22px; border-radius: 10px; object-fit: cover; }
.habit-icon .icon-emoji{ font-size: 20px; }

.progress-list{ display:flex; flex-direction: column; gap: 10px; }

.progress-row{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  padding: 12px 12px;
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
  border-radius: 18px;
  background: color-mix(in srgb, var(--surface2) 92%, transparent);
}
.progress-left{ display:flex; align-items:center; gap: 10px; min-width:0; }
.progress-title{
  font-weight: 800;
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.progress-right{ text-align:right; }
.progress-count{ font-weight: 800; font-size: 14px; }
.progress-sub{ font-size: 12px; color: color-mix(in srgb, var(--text) 55%, transparent); }

/* ---- Habit manage section ---- */
.divider{
  height: 1px;
  background: color-mix(in srgb, var(--border) 80%, transparent);
  margin: 14px 0;
}

.subttl{
  font-size: 12px;
  font-weight: 800;
  letter-spacing: 0.02em;
  color: color-mix(in srgb, var(--text) 55%, transparent);
  margin-bottom: 8px;
}

.habit-manage-list{ display:flex; flex-direction: column; gap: 10px; }

.habit-manage-row{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 12px;
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
  border-radius: 18px;
  background: color-mix(in srgb, var(--surface2) 92%, transparent);
}

.habit-manage-right{ display:flex; align-items:center; gap: 8px; }

.delbtn{
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(225,29,72,0.10);
  color: #e11d48;
  font-weight: 800;
}
.delbtn:active{ transform: scale(0.985); }

/* ---------- Photo preview ---------- */
.photo-preview{
  margin-top: 10px;
  padding: 12px;
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
  border-radius: 18px;
  background: color-mix(in srgb, var(--surface2) 92%, transparent);
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 12px;
}
.photo-preview img{
  width: 58px;
  height: 58px;
  border-radius: 18px;
  object-fit: cover;
  display:block;
  box-shadow: 0 10px 28px rgba(0,0,0,0.18);
}

/* ---------- Settings ---------- */
.setting-email{ display:flex; flex-direction: column; gap: 4px; }
.setting-email-label{ font-size: 12px; color: color-mix(in srgb, var(--text) 55%, transparent); font-weight: 800; }
.setting-email-value{ font-size: 14px; font-weight: 800; word-break: break-all; }

.setting-row{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 12px;
  padding: 10px 0;
}
.setting-label{ font-weight: 800; font-size: 14px; }

.colorpick{
  width: 56px;
  height: 40px;
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
  border-radius: 14px;
  background: var(--surface);
  padding: 0;
}

.setting-actions{
  display:flex;
  justify-content:flex-end;
  padding-top: 6px;
}

/* ---------- Cropper stage ---------- */
.crop-panel{ width: min(720px, calc(100% - 18px)); }
.crop-body{ max-height: 75vh; }
.crop-stage{
  width: 100%;
  height: min(52vh, 420px);
  background: rgba(0,0,0,0.03);
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
  border-radius: 18px;
  overflow: hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}
.crop-stage img{ max-width: 100%; display:block; }

.crop-tools{
  margin-top: 10px;
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
}
.zoomrow{
  flex: 1;
  display:flex;
  align-items:center;
  gap: 10px;
}
.zoomlabel{ font-size: 12px; color: color-mix(in srgb, var(--text) 55%, transparent); font-weight: 800; }
#zoomRange{ width: 100%; }
